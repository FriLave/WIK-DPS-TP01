FROM node:latest as build
WORKDIR /app
COPY package.json ./
RUN npm install
COPY . .
RUN npx tsc

FROM node:latest as run
RUN useradd api_user
WORKDIR /app
COPY --from=build /app/node_modules /node_modules
COPY --from=build /app/build .
USER api_user
CMD ["node", "./app.js"]